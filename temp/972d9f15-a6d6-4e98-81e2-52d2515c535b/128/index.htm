<!DOCTYPE HTML><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=unicode">
<title>CoccToPMS</title>
    
<style id="wiz_custom_css">html, body {font-size: 12pt;}body {font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height: 1.6;margin: 0 auto;padding: 20px 16px;padding: 1.25rem 1rem;}h1, h2, h3, h4, h5, h6 {margin:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bold;}h1 {font-size:20pt;font-size:1.67rem;}h2 {font-size:18pt;font-size:1.5rem;}h3 {font-size:15pt;font-size:1.25rem;}h4 {font-size:14pt;font-size:1.17rem;}h5 {font-size:12pt;font-size:1rem;}h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}div, p, ul, ol, dl, li {margin:0;}blockquote, table, pre, code {margin:8px 0;}ul, ol {padding-left:32px;padding-left:2rem;}ol.wiz-list-level1 > li {list-style-type:decimal;}ol.wiz-list-level2 > li {list-style-type:lower-latin;}ol.wiz-list-level3 > li {list-style-type:lower-roman;}blockquote {padding:0 12px;padding:0 0.75rem;}blockquote > :first-child {margin-top:0;}blockquote > :last-child {margin-bottom:0;}img {border:0;max-width:100%;height:auto !important;margin:2px 0;}table {border-collapse:collapse;border:1px solid #bbbbbb;}td, th {padding:4px 8px;border-collapse:collapse;border:1px solid #bbbbbb;min-height:28px;word-break:break-all;box-sizing: border-box;}.wiz-hide {display:none !important;}</style><style name="wiz_unsave_style">html, body {    font-size: 12pt;}body {    font-family: Helvetica, 'Hiragino Sans GB', 微软雅黑, 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;    line-height: 1.6;    color: inherit;    background-color: inherit;    margin: 0 auto;    padding: 20px 16px;    padding: 1.25rem 1rem;}img{    max-width: 100%;}</style><style name="wiz_style_for_load"></style><script type="text/javascript" src="file:///C:\Tools\WizNote\WizTools\htmleditor\utils.js" wiz_style="unsave" charset="utf-8"></script><script type="text/javascript" src="file:///C:\Tools\WizNote\WizTools\htmleditor\localize.js" wiz_style="unsave" charset="utf-8"></script><script type="text/javascript" src="file:///C:\Tools\WizNote\WizTools\htmleditor\core\wizEditorForPc.js" wiz_style="unsave" charset="utf-8"></script><script type="text/javascript" src="file:///C:\Tools\WizNote\WizTools\htmleditor\editorHelper.js" wiz_style="unsave" charset="utf-8"></script><script type="text/javascript" src="file:///C:\Users\peak\Documents\My Knowledge\templates\WizTemplate.js" wiz_style="unsave" charset="utf-8"></script></head>

<body spellcheck="false" class="" ><div>【问题】</div><div>1.无法连接至数据库 &nbsp; &nbsp;--&gt; &nbsp; &nbsp;其他服务可能连接占用完导致连接不上，因为本服务经再三确认所有打开的连接均已释放，没有未关闭的</div><div>2.程序不运行 &nbsp; &nbsp;--&gt; &nbsp; &nbsp;长时间无法正常连接数据库导致程序自动退出</div><div><br></div><div><br></div><div>1.天数据异常导致程序退出<br></div><div>2.保存数据有异常<br></div><div>3.补传数据有异常line78</div><div><br></div><div>只获取一个数据库连接<br></div><div>每次判断con是否为空，为空重新获取<br></div><div><br></div><div>不为空执行select * from dual<br></div><div>if(成功)</div><div>&nbsp; &nbsp; 查询数据库连接<br></div><div>&nbsp; &nbsp; 正常获取数据<br></div><div>else</div><div>&nbsp; &nbsp; 先关闭con<br></div><div>&nbsp; &nbsp; 再重新获取<br></div><div><br></div><div><br></div><div>首先，确实是因为本程序存在问题导致服务未能正常运行，同时由于分析此问题需要了一些时间，所以未能在第一时间给出回复，故在此说声抱歉，针对本次出现的问题及分析已整理如下：</div><div><br></div><div>问题说明：</div><div>=====================================================</div><div>经过测试和分析，目前可以确定出以下问题：</div><div>1.无法连接至数据库</div><div>2.程序停止未能正常执行</div><div><br></div><div>分析：</div><div>======================================================</div><div>【问题1】</div><div>猜想1：</div><div><span style="color: inherit; font-size: 1rem; line-height: 1.6;">&nbsp; &nbsp;&nbsp;</span><span style="color: inherit; font-size: 1rem; line-height: 1.6;">由于上次于9.28日出了无法连接数据库的问题，原因是由于有一个连接未关闭，导致长时间运行连接数被占用完，可能此次是同样问题</span></div><div><span style="color: inherit; font-size: 1rem; line-height: 1.6;">验证：</span></div><div><span style="color: inherit; font-size: 1rem; line-height: 1.6;">&nbsp; &nbsp;&nbsp;</span><span style="color: inherit; font-size: 1rem; line-height: 1.6;">故本次严谨分析了代码和日志，发现所有打开的连接数和关闭的连接数是一样的，没发现未关闭的地方</span></div><div><span style="color: inherit; font-size: 1rem; line-height: 1.6;">结论：</span></div><div>&nbsp; &nbsp; 并不是由于上次所出现的本程序未关闭连接导致连不上数据库<span style="color: inherit; font-size: 1rem; line-height: 1.6;"><br></span></div><div><br></div><div>猜想2：</div><div>&nbsp; &nbsp; 网络等硬件故障<br></div><div>验证：</div><div>&nbsp; &nbsp; 现场环境其他服务都正常运行<br></div><div>结论：</div><div>&nbsp; &nbsp; 此问题排除<br></div><div><br></div><div>猜想3：</div><div>&nbsp; &nbsp; 跟数据库有关的其他服务占用了所有连接未释放资源，导致本服务无法连接<br></div><div>验证：</div><div><img src="index_files/3f086b4313e12582ab233b3b7a9b62b4.png" border="0"></div><div>&nbsp; &nbsp; 在2017.10.10 10:12:25重启了该单个服务，此时数据库未能正常连接，由于程序重启时所有连接均会释放掉，所以在重启时该程序未占用连接，但依然连不上<br></div><div>结论：</div><div>&nbsp; &nbsp; 所以推断有可能是其他连接数据库的服务有连接未释放，导致连接数满无法获取新的（但该结论未能得到确认只能猜测）<br></div><div><br></div><div>猜想n.....</div><div><br></div><div>【问题2】</div><div>原因：由于长时间未能正常获取数据库连接，导致该定时器线程挂起停止工作</div><div><br></div><div>【解决方案】</div><div>=============================================================</div><div>[需要解决的问题]</div><div>由于问题均由无法获取到数据库连接导致，所以解决此问题即可</div><div><br></div><div>[目前实现方案]</div><div>目前的实现是需要查询数据时打开一个新的连接，查询完数据立刻关闭连接</div><div><br></div><div>[新的实现方案]</div><div>程序运行需要连接数据库时判断当前连接是否可用，可用则直接使用不创建新的，不可用再创建一个新的连接，这样能保证程序永远只占用最初的同一个连接并不会产生新的，程序运行时该连接不释放直至程序停止，因为程序停止时连接会自动释放，故也不影响其他应用连接数据库</div><div><br></div><div>========</div><div>&nbsp; &nbsp; 以上是我对本次问题的浅薄分析，若有不到位的地方，希望各位能给出意见，旨在更快更好的完善服务，谢谢！<br></div><div>&nbsp; &nbsp;&nbsp;<br></div><div><br></div><div><br></div><div>&nbsp; &nbsp;&nbsp;<br></div></body></html>